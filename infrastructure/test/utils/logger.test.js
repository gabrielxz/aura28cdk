"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const logger_1 = require("../../lambda/utils/logger");
describe('Logger utility', () => {
    describe('redact function', () => {
        it('should redact email addresses', () => {
            const input = 'User email is john.doe@example.com';
            const output = (0, logger_1.redact)(input);
            expect(output).toBe('User email is john.doe@[REDACTED]');
        });
        it('should redact JWT tokens', () => {
            const input = 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c';
            const output = (0, logger_1.redact)(input);
            expect(output).toBe('Authorization: Bearer [REDACTED]');
        });
        it('should redact AWS access keys', () => {
            const input = 'AWS Key: AKIAIOSFODNN7EXAMPLE';
            const output = (0, logger_1.redact)(input);
            expect(output).toBe('AWS Key: [REDACTED_AWS_KEY]');
        });
        it('should redact generic tokens', () => {
            const input = 'token=abcdefghijklmnopqrstuvwxyz123456';
            const output = (0, logger_1.redact)(input);
            expect(output).toBe('token=[REDACTED]');
        });
        it('should handle multiple redactions in one string', () => {
            const input = 'User test@example.com has token=verylongtokenvalue123456789';
            const output = (0, logger_1.redact)(input);
            expect(output).toBe('User test@[REDACTED] has token=[REDACTED]');
        });
    });
    describe('redactObject function', () => {
        it('should redact sensitive keys in objects', () => {
            const input = {
                userId: 'user-123',
                email: 'john@example.com',
                token: 'secret-token-value',
                data: 'regular data',
            };
            const output = (0, logger_1.redactObject)(input);
            expect(output).toEqual({
                userId: 'user-123',
                email: '[REDACTED]',
                token: '[REDACTED]',
                data: 'regular data',
            });
        });
        it('should handle nested objects', () => {
            const input = {
                user: {
                    id: '123',
                    email: 'test@example.com',
                    profile: {
                        name: 'John',
                        password: 'super-secret',
                    },
                },
            };
            const output = (0, logger_1.redactObject)(input);
            expect(output).toEqual({
                user: {
                    id: '123',
                    email: '[REDACTED]',
                    profile: {
                        name: 'John',
                        password: '[REDACTED]',
                    },
                },
            });
        });
        it('should handle arrays', () => {
            const input = [
                { email: 'user1@example.com', id: 1 },
                { email: 'user2@example.com', id: 2 },
            ];
            const output = (0, logger_1.redactObject)(input);
            expect(output).toEqual([
                { email: '[REDACTED]', id: 1 },
                { email: '[REDACTED]', id: 2 },
            ]);
        });
        it('should handle null and undefined', () => {
            expect((0, logger_1.redactObject)(null)).toBeNull();
            expect((0, logger_1.redactObject)(undefined)).toBeUndefined();
        });
        it('should redact authorization headers', () => {
            const input = {
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9',
                },
            };
            const output = (0, logger_1.redactObject)(input);
            expect(output).toEqual({
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: '[REDACTED]',
                },
            });
        });
    });
    describe('logger methods', () => {
        let consoleInfoSpy;
        let consoleWarnSpy;
        let consoleErrorSpy;
        beforeEach(() => {
            consoleInfoSpy = jest.spyOn(console, 'info').mockImplementation();
            consoleWarnSpy = jest.spyOn(console, 'warn').mockImplementation();
            consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
        });
        afterEach(() => {
            consoleInfoSpy.mockRestore();
            consoleWarnSpy.mockRestore();
            consoleErrorSpy.mockRestore();
        });
        it('should redact email in info log', () => {
            logger_1.logger.info('User logged in: test@example.com');
            expect(consoleInfoSpy).toHaveBeenCalledWith('User logged in: test@[REDACTED]', '');
        });
        it('should redact sensitive data in info log', () => {
            logger_1.logger.info('User data', { email: 'test@example.com', name: 'John' });
            expect(consoleInfoSpy).toHaveBeenCalledWith('User data', expect.stringContaining('"email": "[REDACTED]"'));
            expect(consoleInfoSpy).toHaveBeenCalledWith('User data', expect.stringContaining('"name": "John"'));
        });
        it('should redact in warn logs', () => {
            logger_1.logger.warn('Invalid token: Bearer abc123def456ghi789jkl012mno345pqr678');
            expect(consoleWarnSpy).toHaveBeenCalledWith('Invalid token: Bearer [REDACTED]', '');
        });
        it('should redact Error messages', () => {
            const error = new Error('Failed to authenticate user@example.com');
            logger_1.logger.error('Authentication failed', error);
            expect(consoleErrorSpy).toHaveBeenCalledWith('Authentication failed', expect.stringContaining('"message": "Failed to authenticate user@[REDACTED]"'));
        });
        it('should handle errors without stack trace', () => {
            const error = { message: 'User test@example.com not found', code: 404 };
            logger_1.logger.error('Error occurred', error);
            expect(consoleErrorSpy).toHaveBeenCalledWith('Error occurred', expect.stringContaining('"message": "User test@[REDACTED] not found"'));
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2VyLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJsb2dnZXIudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNEQUF5RTtBQUV6RSxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7UUFDL0IsRUFBRSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtZQUN2QyxNQUFNLEtBQUssR0FBRyxvQ0FBb0MsQ0FBQztZQUNuRCxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQU0sRUFBQyxLQUFLLENBQUMsQ0FBQztZQUM3QixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7UUFDM0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO1lBQ2xDLE1BQU0sS0FBSyxHQUNULG1MQUFtTCxDQUFDO1lBQ3RMLE1BQU0sTUFBTSxHQUFHLElBQUEsZUFBTSxFQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsa0NBQWtDLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7WUFDdkMsTUFBTSxLQUFLLEdBQUcsK0JBQStCLENBQUM7WUFDOUMsTUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFNLEVBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1FBQ3JELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtZQUN0QyxNQUFNLEtBQUssR0FBRyx3Q0FBd0MsQ0FBQztZQUN2RCxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQU0sRUFB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SixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7WUFDbEQsTUFBTSxLQUFLLEdBQUcsRUFBRSxPQUFPLEVBQUUsaUNBQWlDLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDO1lBQ3hFLGVBQU0sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDLG9CQUFvQixDQUMxQyxnQkFBZ0IsRUFDaEIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLDZDQUE2QyxDQUFDLENBQ3ZFLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBsb2dnZXIsIHJlZGFjdCwgcmVkYWN0T2JqZWN0IH0gZnJvbSAnLi4vLi4vbGFtYmRhL3V0aWxzL2xvZ2dlcic7XG5cbmRlc2NyaWJlKCdMb2dnZXIgdXRpbGl0eScsICgpID0+IHtcbiAgZGVzY3JpYmUoJ3JlZGFjdCBmdW5jdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlZGFjdCBlbWFpbCBhZGRyZXNzZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnB1dCA9ICdVc2VyIGVtYWlsIGlzIGpvaG4uZG9lQGV4YW1wbGUuY29tJztcbiAgICAgIGNvbnN0IG91dHB1dCA9IHJlZGFjdChpbnB1dCk7XG4gICAgICBleHBlY3Qob3V0cHV0KS50b0JlKCdVc2VyIGVtYWlsIGlzIGpvaG4uZG9lQFtSRURBQ1RFRF0nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVkYWN0IEpXVCB0b2tlbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnB1dCA9XG4gICAgICAgICdBdXRob3JpemF0aW9uOiBCZWFyZXIgZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lJeE1qTTBOVFkzT0Rrd0lpd2libUZ0WlNJNklrcHZhRzRnUkc5bElpd2lhV0YwSWpveE5URTJNak01TURJeWZRLlNmbEt4d1JKU01lS0tGMlFUNGZ3cE1lSmYzNlBPazZ5SlZfYWRRc3N3NWMnO1xuICAgICAgY29uc3Qgb3V0cHV0ID0gcmVkYWN0KGlucHV0KTtcbiAgICAgIGV4cGVjdChvdXRwdXQpLnRvQmUoJ0F1dGhvcml6YXRpb246IEJlYXJlciBbUkVEQUNURURdJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlZGFjdCBBV1MgYWNjZXNzIGtleXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnB1dCA9ICdBV1MgS2V5OiBBS0lBSU9TRk9ETk43RVhBTVBMRSc7XG4gICAgICBjb25zdCBvdXRwdXQgPSByZWRhY3QoaW5wdXQpO1xuICAgICAgZXhwZWN0KG91dHB1dCkudG9CZSgnQVdTIEtleTogW1JFREFDVEVEX0FXU19LRVldJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlZGFjdCBnZW5lcmljIHRva2VucycsICgpID0+IHtcbiAgICAgIGNvbnN0IGlucHV0ID0gJ3Rva2VuPWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2JztcbiAgICAgIGNvbnN0IG91dHB1dCA9IHJlZGFjdChpbnB1dCk7XG4gICAgICBleHBlY3Qob3V0cHV0KS50b0JlKCd0b2tlbj1bUkVEQUNURURdJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtdWx0aXBsZSByZWRhY3Rpb25zIGluIG9uZSBzdHJpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnB1dCA9ICdVc2VyIHRlc3RAZXhhbXBsZS5jb20gaGFzIHRva2VuPXZlcnlsb25ndG9rZW52YWx1ZTEyMzQ1Njc4OSc7XG4gICAgICBjb25zdCBvdXRwdXQgPSByZWRhY3QoaW5wdXQpO1xuICAgICAgZXhwZWN0KG91dHB1dCkudG9CZSgnVXNlciB0ZXN0QFtSRURBQ1RFRF0gaGFzIHRva2VuPVtSRURBQ1RFRF0nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlZGFjdE9iamVjdCBmdW5jdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlZGFjdCBzZW5zaXRpdmUga2V5cyBpbiBvYmplY3RzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5wdXQgPSB7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgZW1haWw6ICdqb2huQGV4YW1wbGUuY29tJyxcbiAgICAgICAgdG9rZW46ICdzZWNyZXQtdG9rZW4tdmFsdWUnLFxuICAgICAgICBkYXRhOiAncmVndWxhciBkYXRhJyxcbiAgICAgIH07XG4gICAgICBjb25zdCBvdXRwdXQgPSByZWRhY3RPYmplY3QoaW5wdXQpO1xuICAgICAgZXhwZWN0KG91dHB1dCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXJJZDogJ3VzZXItMTIzJyxcbiAgICAgICAgZW1haWw6ICdbUkVEQUNURURdJyxcbiAgICAgICAgdG9rZW46ICdbUkVEQUNURURdJyxcbiAgICAgICAgZGF0YTogJ3JlZ3VsYXIgZGF0YScsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5lc3RlZCBvYmplY3RzJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5wdXQgPSB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogJzEyMycsXG4gICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBwcm9maWxlOiB7XG4gICAgICAgICAgICBuYW1lOiAnSm9obicsXG4gICAgICAgICAgICBwYXNzd29yZDogJ3N1cGVyLXNlY3JldCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBjb25zdCBvdXRwdXQgPSByZWRhY3RPYmplY3QoaW5wdXQpO1xuICAgICAgZXhwZWN0KG91dHB1dCkudG9FcXVhbCh7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogJzEyMycsXG4gICAgICAgICAgZW1haWw6ICdbUkVEQUNURURdJyxcbiAgICAgICAgICBwcm9maWxlOiB7XG4gICAgICAgICAgICBuYW1lOiAnSm9obicsXG4gICAgICAgICAgICBwYXNzd29yZDogJ1tSRURBQ1RFRF0nLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGFycmF5cycsICgpID0+IHtcbiAgICAgIGNvbnN0IGlucHV0ID0gW1xuICAgICAgICB7IGVtYWlsOiAndXNlcjFAZXhhbXBsZS5jb20nLCBpZDogMSB9LFxuICAgICAgICB7IGVtYWlsOiAndXNlcjJAZXhhbXBsZS5jb20nLCBpZDogMiB9LFxuICAgICAgXTtcbiAgICAgIGNvbnN0IG91dHB1dCA9IHJlZGFjdE9iamVjdChpbnB1dCk7XG4gICAgICBleHBlY3Qob3V0cHV0KS50b0VxdWFsKFtcbiAgICAgICAgeyBlbWFpbDogJ1tSRURBQ1RFRF0nLCBpZDogMSB9LFxuICAgICAgICB7IGVtYWlsOiAnW1JFREFDVEVEXScsIGlkOiAyIH0sXG4gICAgICBdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwgYW5kIHVuZGVmaW5lZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChyZWRhY3RPYmplY3QobnVsbCkpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QocmVkYWN0T2JqZWN0KHVuZGVmaW5lZCkpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVkYWN0IGF1dGhvcml6YXRpb24gaGVhZGVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IGlucHV0ID0ge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyIGV5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOScsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgICAgY29uc3Qgb3V0cHV0ID0gcmVkYWN0T2JqZWN0KGlucHV0KTtcbiAgICAgIGV4cGVjdChvdXRwdXQpLnRvRXF1YWwoe1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiAnW1JFREFDVEVEXScsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xvZ2dlciBtZXRob2RzJywgKCkgPT4ge1xuICAgIGxldCBjb25zb2xlSW5mb1NweTogamVzdC5TcHlJbnN0YW5jZTtcbiAgICBsZXQgY29uc29sZVdhcm5TcHk6IGplc3QuU3B5SW5zdGFuY2U7XG4gICAgbGV0IGNvbnNvbGVFcnJvclNweTogamVzdC5TcHlJbnN0YW5jZTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgY29uc29sZUluZm9TcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdpbmZvJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG4gICAgICBjb25zb2xlV2FyblNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ3dhcm4nKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcbiAgICAgIGNvbnNvbGVFcnJvclNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goKCkgPT4ge1xuICAgICAgY29uc29sZUluZm9TcHkubW9ja1Jlc3RvcmUoKTtcbiAgICAgIGNvbnNvbGVXYXJuU3B5Lm1vY2tSZXN0b3JlKCk7XG4gICAgICBjb25zb2xlRXJyb3JTcHkubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVkYWN0IGVtYWlsIGluIGluZm8gbG9nJywgKCkgPT4ge1xuICAgICAgbG9nZ2VyLmluZm8oJ1VzZXIgbG9nZ2VkIGluOiB0ZXN0QGV4YW1wbGUuY29tJyk7XG4gICAgICBleHBlY3QoY29uc29sZUluZm9TcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdVc2VyIGxvZ2dlZCBpbjogdGVzdEBbUkVEQUNURURdJywgJycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWRhY3Qgc2Vuc2l0aXZlIGRhdGEgaW4gaW5mbyBsb2cnLCAoKSA9PiB7XG4gICAgICBsb2dnZXIuaW5mbygnVXNlciBkYXRhJywgeyBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLCBuYW1lOiAnSm9obicgfSk7XG4gICAgICBleHBlY3QoY29uc29sZUluZm9TcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnVXNlciBkYXRhJyxcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1wiZW1haWxcIjogXCJbUkVEQUNURURdXCInKSxcbiAgICAgICk7XG4gICAgICBleHBlY3QoY29uc29sZUluZm9TcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnVXNlciBkYXRhJyxcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1wibmFtZVwiOiBcIkpvaG5cIicpLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVkYWN0IGluIHdhcm4gbG9ncycsICgpID0+IHtcbiAgICAgIGxvZ2dlci53YXJuKCdJbnZhbGlkIHRva2VuOiBCZWFyZXIgYWJjMTIzZGVmNDU2Z2hpNzg5amtsMDEybW5vMzQ1cHFyNjc4Jyk7XG4gICAgICBleHBlY3QoY29uc29sZVdhcm5TcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdJbnZhbGlkIHRva2VuOiBCZWFyZXIgW1JFREFDVEVEXScsICcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVkYWN0IEVycm9yIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBhdXRoZW50aWNhdGUgdXNlckBleGFtcGxlLmNvbScpO1xuICAgICAgbG9nZ2VyLmVycm9yKCdBdXRoZW50aWNhdGlvbiBmYWlsZWQnLCBlcnJvcik7XG4gICAgICBleHBlY3QoY29uc29sZUVycm9yU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcsXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdcIm1lc3NhZ2VcIjogXCJGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXJAW1JFREFDVEVEXVwiJyksXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZXJyb3JzIHdpdGhvdXQgc3RhY2sgdHJhY2UnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IHsgbWVzc2FnZTogJ1VzZXIgdGVzdEBleGFtcGxlLmNvbSBub3QgZm91bmQnLCBjb2RlOiA0MDQgfTtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3Igb2NjdXJyZWQnLCBlcnJvcik7XG4gICAgICBleHBlY3QoY29uc29sZUVycm9yU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ0Vycm9yIG9jY3VycmVkJyxcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1wibWVzc2FnZVwiOiBcIlVzZXIgdGVzdEBbUkVEQUNURURdIG5vdCBmb3VuZFwiJyksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19